---
title: "inertia_coordination"
author: "Emily Butler, eabutler@u.arizona.edu"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{inertia_coordination}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
knitr::opts_knit$set(global.par=TRUE)
)
```

The Inertia-Coordination model represents the within-person pattern of inertia, which is defined as the extent to which a person’s state can be predicted from his or her own state at a prior time point, and the between-person pattern of coordination, which is defined as the extent to which one partner’s state can be predicted from their partner’s state either concurrently or time-lagged (Reed, Randall, Post, & Butler, 2013). Specifically, the time-series state variable is predicted by the following: 1) separate intercepts for each partner, 2) a person’s own state variable at a prior time point, which gives two “inertia” estimates, one for each partner, and 3) the person’s partner’s state variable at the same prior time point, which gives two “coordination” estimates, again one for each partner. The lm model used by the rties functions is:    

lm(obs_deTrend ~ -1 + dist0 + dist1 + dist0:obs_deTrend_Lag + dist0:p_obs_deTrend_Lag + dist1:obs_deTrend_Lag + dist1:p_obs_deTrend_Lag, na.action=na.exclude, data=datai)

where “obs_deTrend” is the observed state variable with individual linear trends removed (e.g., it is the residuals from each person’s state variable predicted from time). The “-1” , “dist0” and “dist1” work together to implement a two-intercept model, whereby the overall intercept is omitted and instead separate intercepts are estimated for the level-0 and level-1 of the distinguisher variable provided by the user (for a discussion of this approach see: Kenny, Kashy, & Cook, 2006). The terms “dist0:obs_deTrend_Lag” and “dist1:obs_deTrend_Lag” estimate the inertia parameters for the partners scored 0 and 1 respectively on the distinguishing variable (e.g., “obs_deTrend_Lag” is the person’s own de-trended observed state variable lagged by how ever many steps the user specifies). Similarly, “dist0:p_obs_deTrend_Lag” and “dist1:p_obs_deTrend_Lag” estimate the coordination parameters for the partners scored 0 and 1 respectively on the distinguishing variable (e.g., “p_obs_deTrend_Lag” is the person’s partner's de-trended observed state variable lagged by how ever many steps the user specifies). The model is estimated separately for each dyad (e.g., “datai” is the data from couple “i”).  

As for all _rties_ analyses, we start by loading the library and inspecting/preparing the data. Here we skip the details; see the overview_data_prep vignette. 

```{r}
library(rties)
data1 <- rties_ExampleData_2
dyads <- c(19)
data2 <- removeDyads(data1, dyads, data1$couple)
```

One complexity in using the Inertia-Coordination model is that the results are highly dependent upon the chosen lag length (for discussion of a similar issue when choosing the measurement interval see: Boker & Nesselroade, 2002). This dependence on the lag makes interpretation problematic unless one has a strong theory about the temporal processes at work. At a minimum, it is a good idea to inspect the auto-correlation (relevant to inertia) and cross-correlation (relevant to coordination)  plots for the observed state variables. If the state variables are oscillating at all, the auto- and cross- correlations will also oscillate depending on lag. For example, the correlations can vary from negative, to zero, to positive depending on the lag and some informed decision must be made (or exploration under-taken in the absence of theory) about what lag is most meaningful for the process one is studying. To facilitate this _rties_ provides functions to produce the plots. Here we plot a chosen subset to show the strong impact that is sometimes found due to lag, especially for cross-correlation. 

```{r, include=FALSE}
par(mar=c(1,1,1,1))
```
```{r}
temp <- subset(data2, couple %in% c(2,5,27,31,47,60))
autoCorPlots(temp, "person","couple","dial","time")
crossCorPlots(temp, "person","couple","dial","time")
```

Technically, the same problem exists with inertia, but pragmatically we have not observed the issue in our own or published research. Specifically, reported inertia estimates are typically positive, while coordination estimates show greater variance. By restricting the model to concurrent coordination, interpretation is simplified (see Figure 1 in overview_data_prep.pdf). Higher positive inertia implies slower fluctuations in emotional responding. If one obtains a negative inertia estimate, however, it implies that the observed variable is oscillating back and forth between each lag. For the between-person coordination parameters, a positive estimate implies an in-phase pattern, such that when one partner is high on some measure of emotion, so is their partner, while a negative parameter implies an anti-phase pattern, such that when one partner is high the other partner is low (Randall, Post, Reed, & Butler, 2013; Reed et al., 2013; Wilson et al., 2018).
There are two sample size considerations for each of the models implemented in rties. The first pertains to the number of observations per dyad that are required, while the second is the number of dyads required. The first consideration comes into play when we estimate the dynamics one dyad at a time. Greater complexity requires finer-grained measurement of time and hence more observations per dyad. One advantage of the inertia-coordination model is that it is fairly simple and hence requires relatively few observations per dyad. The exact number will depend on how much variance there is over time, both within-people and between-partners, but it is likely to provide good results with as few as 5 observations per dyad (someone should do a simulation study of this!). As an informal rule-of-thumb, if you do not get any convergence error messages or any out-of-bound estimates (e.g., negative variance estimates, estimated effects of infinity) then you can assume you had enough data to trust the results. The number of observations will impact the choice of lag, however, because for each lag you lose one observation point (e.g., if the lag is two steps, then the inertia estimates will be based on the total number of observations per dyad minus 2). Thus choosing the lag relies on a combination of theory, prior research, how quickly you expect the phenomenon of interest to be changing and how many observation time points there were. One strength of rties is that it makes it very easy to alter the lag length and observe the impact on the results (see setting the lag length in “overview_data_prep.pdf”), which is helpful for developing an intuitive understanding of inertia.
The second sample size consideration comes into play when we use the estimated dynamics to either predict the system variable, or be predicted by it. In both cases, the system variable can be either a dyadic variable (e.g., both partners have the same score, as in relationship length) or an individual variable (e.g., partners can have different scores, as in age). In the case of predicting a dyadic system variable, a regular multiple regression model is appropriate. In this case, the shared system variable is predicted by both partners’ inertia and coordination parameter estimates and you can use your favorite rule of thumb along the lines of “n observations for each of 4 predictors” to choose your sample size, or you can conduct a power analysis. The situation is more complicated when the system variable is assessed at the individual level, or when it is the predictor of the dynamics. In the former case, the partner’s system variable scores are predicted by actor- and partner- effects of the inertia and coordination parameter estimates using a cross-sectional random-intercept dyadic model. In the latter case, the set of inertia and coordination parameter estimates are predicted by the system variable using a multivariate correlated-residuals dyadic model. If the system variable is at the individual level, both actor- and partner- effects are included in the model. Estimating statistical power for all of these models is non-trivial and would be a good topic for someone to write a paper about (for a great new tool that could be used for this purpose, see the R package “simr”). Nevertheless, as with the number of observations required over time, if you do not get any convergence error messages or any out-of-bound estimates then you can assume you had enough data to trust the results, but you will not know the power of the significance tests.
The first step in an rties analysis is to follow the instructions in “overview_data_prep.pdf” to visualize and prepare the data. As described there, the end result is a dataframe (called “data3” in our example) that has the processed data ready for rties modeling. The next step, which is often neglected in the literature, is to assess how well different variants of the inertia-coordination model fit the observed temporal data. Our ultimate goal is to either predict outcomes of interest from the dynamics assessed by the inertia-coordination model, or to test whether other variables predict those dynamics. Either way, the results are only meaningful if the inertia-coordination model does, in fact, realistically represent the dynamics of the system. We therefore provide a set of functions that fit three versions of the model to each dyad's data and return named lists that include: 1) the adjusted R^2 for each dyad for each model (“R2” e.g., how well each model predicts the observed temporal trajectories of the data), 2) the parameter estimates for the model (“paramData”, for use later in either predicting, or being predicted by, the system variable), and 3) plots of the predicted values superimposed on the observed values for each dyad. The plots can be accessed from the returned list entry (“plots”) and they are also automatically
saved as a .pdf file in the working directory (this process takes awhile and a blank quartz window may appear, depending on your computer). The three models are: 1) an inertia-only model, 2) a coordination- only model, and 3) the full inertia-coordination model. Each function takes the name of the processed dataframe, names for the two levels of the distinguishing variable in the correct order (0 first, then 1; these names will be used to label legends on the plots) and a name for the observed state variable (again, this name will appear on the y-axis of the plots).






